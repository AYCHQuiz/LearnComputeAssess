---
output:
  html_document:
    self_contained: false
  pdf_document: default
---

# [DRAFT] Analysis of Software and Data Carpentry's Pre- and Post-Workshop Surveys
### Authors: The Carpentries Assessment Team
### Published: July 2018

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(DBI)
library(ggmap)
library(likert)
library(mapproj)
library(RColorBrewer)
library(srvyr)
library(beeswarm)
library(NPS)
library(broom)
library(assertr)
library(viridis)
library(patchwork)
opts_chunk$set(echo = FALSE,
               message = FALSE,
               warning = FALSE)
## puts all figures in figures folder
opts_chunk$set(fig.path='figures/', fig.width = 10,  fig.retina = 2)


to_snake_case <- function(x) tolower(gsub("([a-z])([A-Z])", "\\1_\\2", x))

## returns TRUE when the respondent has answered at least one question.
has_answers <- function(d) {
    d %>%
        select(-matches("date")) %>%
        mutate(has_answers = rowSums(is.na(.)) < ncol(.)) %>%
        pull(has_answers)   
}


convert_label <- function(x) {
    x <- gsub("_([a-z])", " \\U\\1", x, perl = TRUE)
    gsub("^([a-z])", "\\U\\1", x, perl = TRUE)
}

```


```{r load-dc-data}
# Load DC pre and post-workshop data
# Data Carpentry Pre-Workshop Data
dcpredata <- readr::read_csv("data/180511_dcpre.csv",
                             col_types = cols(
                                 Date =  col_datetime(
                                     format = "%m/%d/%y %H:%M"
                                 ),
                                 .default = "c")
                             ) %>%
    rename(
        ## ---- discipline ----
        "discipline_1"  = Discipline,        
        "discipline_2"  = Column2, 
        "discipline_3"  = Column3, 
        "discipline_4"  = Column4, 
        "discipline_5"  = Column5, 
        "discipline_6"  = Column6, 
        "discipline_7"  = Column7, 
        "discipline_8"  = Column8, 
        "discipline_9"  = Column9, 
        "discipline_10" = Column10, 
        "discipline_11" = Column11, 
        "discipline_12" = Column12, 
        "discipline_13" = Column13,
        "discipline_other" = DisciplineOther, 
        ## ---- status ----
        "status_1" = Status, 
        "status_2" = Column15, 
        "status_3" = Column16, 
        "status_4" = Column17, 
        "status_5" = Column18, 
        "status_6" = Column19, 
        "status_7" = Column20,
        "status_8" = Column21,
        "status_9" = Column22,
        ## ---- why_attending ----
        "why_attending_1" = WhyAttending,
        "why_attending_2" = Column27,
        "why_attending_3" = Column28,
        "why_attending_4" = Column29,
        "why_attending_other" = WhyAttendingOther, 
        ## ---- exposure ----
        "exposure_1" = Exposure,
        "exposure_2" = Column31,
        "exposure_3" = Column32,
        "exposure_4" = Column33,
        "exposure_5" = Column34,
        "exposure_6" = Column35,
        "exposure_other" = ExposureOther,
        ## ---- ethnic_identiity ----
        "ethnic_identity_1" = RaceEthnicIdentity,
        "ethnic_identity_2" = Column44,
        "ethnic_identity_3" = Column45, 
        "ethnic_identity_4" = Column46,
        "ethnic_identity_5" = Column47,
        "ethnic_identity_6" = Column48,
        "ethnic_identity_7" = Column49, 
        "ethnic_identity_other" = RaceEthnicIdentityOther
    ) %>%
    rename_all(to_snake_case) %>%
    filter(has_answers(.))

# Data Carpentry Post-Workshop Data
dcpostdata <- readr::read_csv("data/180511_dcpost.csv",
                              col_types = cols(
                                  Date =  col_datetime(
                                      format = "%m/%d/%y %H:%M"
                                  ),
                                  .default = "c")
                              ) %>%
    rename_all(to_snake_case) %>%
    filter(has_answers(.))
```

```{r load-swc-data}
# Load SWC pre and post-workshop data
# Software Carpentry Pre-Workshop Data
swcpredata <- readr::read_csv("data/180521_swcpre.csv",
                              col_types = cols(
                                  Date =  col_datetime(
                                      format = "%m/%d/%y %H:%M"
                                  ),
                                  .default = "c")
                              ) %>%
    rename(
         ## ---- why_attending ----
        "why_attending_1" = WhyAttending,
        "why_attending_2" = Column4,
        "why_attending_3" = Column5,
        "why_attending_4" = Column6,
        "why_attending_5" = Column7, 
        "why_attending_other" = WhyAttendingOther, 
        ## ---- factors ----
        "factors_1" = Factors,
        "factors_2" = Column13,
        "factors_3" = Column14,
        "factors_other" = FactorsOther,
        ## ---- exposure ----
        "exposure_1" = Exposure,
        "exposure_2" = Column16,
        "exposure_3" = Column17,
        "exposure_4" = Column18,
        "exposure_5" = Column19,
        "exposure_6" = Column20,
        "exposure_7" = Column21,
        "exposure_other" = ExposureOther,
        ## ---- domain ----
        "domain_1" = Domain,
        "domain_2" = Column47,
        "domain_3" = Column48,
        "domain_4" = Column49,
        "domain_5" = Column50,
        "domain_6" = Column51,
        "domain_7" = Column52,
        "domain_8" = Column53,
        "domain_9" = Column54,
        "domain_10" = Column55,
        "domain_11" = Column56,
        "domain_12" = Column57,
        "domain_13" = Column58,
        "domain_14" = Column59,
        "domain_15" = Column60,
        "domain_16" = Column61,
        "domain_other" = DomainOther
    ) %>%
    rename_all(to_snake_case) %>%
    filter(has_answers(.))

# Software Carpentry Post-Workshop Data
swcpostdata <- readr::read_csv("data/180521_swcpost.csv",
                               col_types = cols(
                                   Date =  col_datetime(
                                       format = "%m/%d/%y %H:%M"
                                   ),
                                   .default = "c")
                               ) %>%
    rename(
        ## ---- domain ----
        "domain_1" = Domain,
        "domain_2" = Column50,
        "domain_3" = Column51,
        "domain_4" = Column52,
        "domain_5" = Column53,
        "domain_6" = Column54,
        "domain_7" = Column55,
        "domain_8" = Column56,
        "domain_9" = Column57,
        "domain_10" = Column58,
        "domain_11" = Column59,
        "domain_12" = Column60,
        "domain_13" = Column61,
        "domain_14" = Column62,
        "domain_15" = Column63,
        "domain_16" = Column64,
        "domain_other" = DomainOther
    ) %>%
    rename_all(to_snake_case) %>%
    filter(has_answers(.))
```

```{r}
## number of learners
n_learners_pre_dc <- nrow(dcpredata)
n_learners_post_dc <- nrow(dcpostdata)
n_learners_pre_swc <- nrow(swcpredata)
n_learners_post_swc <- nrow(swcpostdata)
```

```{r}
## time period covered
dc_dates <- range(c(dcpredata$date, dcpostdata$date))
swc_dates <- range(c(swcpredata$date, swcpostdata$date))
```

### Overview

Since `r min(c(dc_dates, swc_dates))`, Software and Data Carpentry have collected information on learner demographics, perception of tools and confidence in working with data. As we continue in our goal to streamline processes as The Carpentries, the Assessment Team completed an analysis of the pre- and post-workshop surveys for both Software and Data Carpentry. The goal of this analysis is to understand the impact our workshops are having on learners, and how we can improve our surveys and assessment infrastructure. This report covers the workshops from `r format(min(swc_dates), format="%B %d, %Y")` to `r format(max(swc_dates), format="%B %d, %Y")` for Software Carpentry, and from  `r format(min(dc_dates), format="%B %d, %Y")` to `r format(max(dc_dates), format="%B %d, %Y")` for Data Carpentry.

As an overview, `r n_learners_pre_dc` and `r n_learners_post_dc` learners have responded to Data Carpentry's pre- and post-workshop surveys respectively, while `r n_learners_pre_swc` and `r n_learners_post_swc` have responded to Software Carpentry's. 

This report includes the following:

- Motivation for Attending Carpentries Workshops
- Workshop Type and Perception of Workshop Environment/Experience
- Effect of Workshops on Learner's Self-Reported Perspectives, Skills, and Confidence
- Ability to Perform Computing Tasks
- Demographics
- Summary

### Motivation for Attending Carpentries Workshops


Learners attend Carpentries workshops for many reasons. Data Carpentry's workshops are domain-specific and focus on the fundamental data skills needed to conduct research. Data Carpentry's Ecology and Social Sciences curricula begin with a lesson on data organization and includes data cleaning with OpenRefine. From there, learners spend time learning a base programming language, either Python or R, to manipulate and visualize data.

Data Carpentry's Genomics curriculum also includes programming, however the focus of this curriculum is on best practices for organization of bioinformatics projects and data, use of command line utilities and tools to analyze sequence quality and perform variant calling, and connecting to and using cloud computing.

#### Why are learners participating to our workshops?

```{r why-attending-helpers}
tally_nona <- function(x) sum(!is.na(x))
percent_nona <- function(x) round(tally_nona(x)/length(x) * 100, 1)

## Extract the relevant columns, and remove answers where repondant didn't
## select anything.
prep_why_attending <- . %>%
    select(starts_with("why_attending"),
           -why_attending_other) %>%
    filter(has_answers(.))
  
## Make table of column name to question correspondance
get_key_multi_answer <- . %>%
    gather(column_name, question) %>%
    filter(!is.na(question)) %>%
    distinct(column_name, question)

## Get numbers and percentage of each option
tally_percent_multi_answer <- . %>%
    summarize_all(funs(n = tally_nona, percent = percent_nona)) %>%    
    gather() %>%
    extract(key, c("column_name", "metric"),
            regex = "([a-z_]+_[0-9])_(n|percent)") %>%
    spread(metric, value) 
```

```{r dc-why-attending}
## Why are you attending this workshop?
dc_why_attending_data <- dcpredata %>%
    prep_why_attending

dc_why_attending_keys <- dc_why_attending_data %>%
    get_key_multi_answer

dc_why_attending <- dc_why_attending_data %>%
    tally_percent_multi_answer %>% 
    inner_join(dc_why_attending_keys, by = "column_name")

### inline statistics
n_dc_why_attending <- nrow(dc_why_attending_data)

## percent of DC learners coming to learn skills they will use in the future (in
## column 'why_attending_1').
p_work_future <- dc_why_attending %>%
    filter(column_name == "why_attending_1") %>%
    pull(percent)

## table
dc_why_attending %>% 
    select(question, n, percent) %>%
    arrange(desc(n)) %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c(
              paste0(
                  "Why learners attend Data Carpentry workshops? (n = ",
                  n_dc_why_attending, ")"),
              "n", "%"))
```

`r p_work_future`% of Data Carpentry learners attend workshops to learn skills they can apply to their work in the future.

```{r swc-why-attending}
# Why are you attending this workshop?
swc_why_attending_data <- swcpredata %>%
    prep_why_attending

swc_why_attending_keys <- swc_why_attending_data %>%
    get_key_multi_answer
    
swc_why_attending <- swc_why_attending_data %>%
    tally_percent_multi_answer %>% 
    inner_join(swc_why_attending_keys, by = "column_name")

### inline statistics
n_swc_why_attending <- nrow(swc_why_attending_data)

## percent SWC learners coming to learn new/additional topics (in column
## 'why_attending_2').
p_swc_why_attending <- swc_why_attending %>%
    filter(column_name == "why_attending_2") %>%
    pull(percent)

## table
swc_why_attending %>%
    select(question, n, percent) %>%
    arrange(desc(n)) %>%
    kable(format = "markdown", row.names = NA,
          col.names = c(
              paste0("Why learners attend Software Carpentry Workshops? (n = ",
                     n_swc_why_attending, ")"),
              "n", "%"))
```


```{r first-timers-swc}
# 1st time attending 
# Software Carpentry: Will this be your first time attending a SWC workshop (as a learner)?

swc_first_timers <- swcpredata %>%
    select(first_time) %>%
    mutate(first_time = replace(first_time,
                                is.na(first_time),
                                "Didn't answer")) %>% 
    count(first_time) %>%
    arrange(factor(first_time, levels = c("Yes", "No", "Didn't answer"))) %>% 
    mutate(percent = round(n/sum(n) * 100, 1))

p_first_timers <- swc_first_timers %>%
    filter(first_time == "Yes") %>%
    pull(percent)

swc_first_timers %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c ("Software Carpentry 1st Time Learners", "n", "%"))
```

Software Carpentry workshops teach automation with the Unix shell, a tool that allows users to run commands interactively or by scripting. In Software Carpentry workshops, version control of source code with Git and GitHub are also taught for learners to learn facilitating contribution and collaboration on online repositories. Programming in R or Python is also taught. Software Carpentry's curriculum teaches basic lab skills for scientific computing. Compared to Data Carpentry's learners, Software Carpentry's tend to have more experience with the tools covered in the workshops, and learners come to learn new and/or additional topics (`r p_swc_why_attending`%). It's also interesting to note that `r p_first_timers`% of Software Carpentry respondents are first-time learners at our workshops.


#### What is the current level of satisfaction of the data management practices of our learners before attending our workshops?

```{r dc-satisfaction-level}
## Satisfaction with current data management practices 
## Data Carpentry
satisfaction_levels <- c("Very unsatisfied", "Unsatisfied", "Neutral",
                         "Satisfied", "Very satisfied", "Not sure",
                         "Not applicable", "Didn't answer")

single_answer_summary <- function(.data, .var, var_levels) {
    var <- enquo(.var)
    
    .data %>%
        select(!! var) %>%
        mutate(!! quo_name(var) := replace(!!var, is.na(!!var),
                                           "Didn't answer")) %>%
        count(!!var) %>%
        mutate(percent = round(n/sum(n) * 100, 1)) %>%
        arrange(factor(!!var, levels = var_levels)) 
}

dc_satisfaction <- dcpredata %>%
    single_answer_summary(current_satisfaction, satisfaction_levels)

dc_percent_unsatisfied <- dc_satisfaction %>%
    filter(current_satisfaction %in% satisfaction_levels[1:3]) %>%
    summarize(p = sum(percent)) %>%
    pull(p)

dc_satisfaction %>%    
    kable(format = 'markdown', row.names = NA,
          col.names = c("Data Carpentry Learners satisfaction with current data management practices",
                        "n", "%"))
```

```{r dc-satisfaction-level-plot}
dc_satisfaction %>%
    filter(current_satisfaction %in% satisfaction_levels[1:5]) %>% 
    ggplot(aes(x = factor(current_satisfaction,
                          levels = satisfaction_levels),
               y = percent)) +
    geom_col() +
    geom_text(aes(label = n, y = percent + 2)) +
    labs(
        x = "",
        y = "Percent",
        title = "Pre-workshop Satisfaction Level with Current Data Management Practices",
        caption = "'Not Sure', 'Not applicable' and 'Didn't answer' not shown"
    ) +
    theme_minimal()
```

The majority (`r dc_percent_unsatisfied`%) of Data Carpentry's respondents are either unsatisfied or feel neutral about being satisfied with their current data management practices. By data management practices, we include behaviors such as keeping your raw data raw, reusing code, and using databases, queries, and scripts to manage large datasets.

#### How often do our workshop participant program before attending our workshops?

```{r dc-programming-usage}
## Programming usage
## Data Carpentry
usage_levels <- c("Never", "Less than once per year",
                  "Several times per year",
                  "Monthly", "Weekly", "Daily",
                  "Didn't answer")

dc_programming_usage <- dcpredata %>%
    single_answer_summary(current_programming, usage_levels)

dc_percent_programming_rare <- dc_programming_usage %>%
    filter(current_programming %in% usage_levels[1:2]) %>%
    summarize(p = sum(percent)) %>%
    pull(p)

dc_percent_programming_daily <- dc_programming_usage %>%
    filter(current_programming  == "Daily") %>%
    pull(percent)
    
dc_programming_usage %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c("Data Carpentry Learners current programming usage",
                        "n", "%"))
```

In terms of current programming usage, `r dc_percent_programming_rare`% of
learners either never use programming, or use programming less than once per
year, but no more than several times per year. Only `r
dc_percent_programming_daily`% program on a daily basis. This is no surprise, as
Data Carpentry workshops tend to attract novices.

```{r dc-exposure}
prep_exposure <- . %>%
    select(starts_with("exposure"),
           - exposure_other) %>%
    filter(has_answers(.))

## How did you find out about this workshop? 
dc_exposure_data <- dcpredata %>%
    prep_exposure

dc_exposure_keys <- dc_exposure_data %>%
    get_key_multi_answer

dc_exposure <- dc_exposure_data %>%
    tally_percent_multi_answer %>%
    inner_join(dc_exposure_keys, by = "column_name")

dc_exposure_mailing <- dc_exposure %>%
    filter(column_name == "exposure_1") %>% # mailing lists
    pull(percent)

dc_exposure %>%
    select(question, n, percent) %>%
    arrange(desc(n)) %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c(
              paste0("How respondents find out about Data Carpentry workshops (n =",
                     nrow(dc_exposure_data),
                     ")"), "n", "%"))
```

```{r swc-exposure}
## How did you find out about this workshop? 
swc_exposure_data <- swcpredata %>%
    prep_exposure

swc_exposure_keys <- swc_exposure_data %>%
    get_key_multi_answer

swc_exposure <- swc_exposure_data %>%
    tally_percent_multi_answer %>%
    inner_join(swc_exposure_keys, by = "column_name")

swc_exposure_mailing <- swc_exposure %>%
    filter(column_name == "exposure_3") %>% # mailing lists + flyers
    pull(percent)

swc_exposure %>%
    select(question, n, percent) %>%
    arrange(desc(n)) %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c(
              paste0("How respondents find out about Software Carpentry workshops (n = ",
                     nrow(swc_exposure_data), ")"), 
              "n", "%"))
```

Data Carpentry and Software Carpentry workshop participants find out mainly about our workshops through institution mailing lists (`r dc_exposure_mailing`% and `r swc_exposure_mailing`% respectively). However, "word-of-mouth" also plays a significant role in populating the workshops.


In summary, both Data and Software Carpentry workshop respondents attend workshops to learn about or improve upon their current data management and analysis skills.


### Workshop Type and Perception of Workshop Environment/Experience

```{r dc-workshop-type}
# Workshop topics
# Data Carpentry: Which workshop are you attending?
workshop_types <- c("Ecology", "Genomics", , "Reproducible Research",
                    "Social Sciences", "Geospatial", "I don't know.",
                    "Didn't answer")

dc_workshop_type <- dcpostdata %>%    
    single_answer_summary(workshop, workshop_types)

## dc_workshop_type %>%
##     kable(format = 'markdown', row.names = NA,
##           col.names = c ("Data Carpentry Workshop Type Attended", "n", "%"))
```

```{r plotting-functions}
ggassessment_hist <- function(data, mapping) {
    ggplot(data, mapping) +
        geom_col(fill = "darkcyan") +
        geom_text(aes(label = n), size = 4, vjust = -0.25) +
        scale_x_discrete(labels = function(x)
            lapply(strwrap(x, width = 10, simplify = FALSE),
                   paste, collapse = "\n")) +
        ylab("% Respondents") +
        theme_classic(base_size = 14)
}

ggassessment_lolli <- function(data, mapping) {
    ggplot(data, mapping) +
        geom_point(size = 2.5, col = "darkcyan") +
        geom_segment(aes(yend = 0), col = "darkcyan") +
        geom_text(aes(label = n), size = 4, nudge_y = 1) +
        coord_flip() +
        ylab("% Respondents") +
        theme_classic(base_size = 14)
}

```{r dc-workshop-type-plot}
## Data Carpentry: Plot for which workshop are you attending?
ggassessment_hist(dc_workshop_type,
                  aes(x = factor(workshop, levels = workshop_types),
                      y = percent)) +
    labs(
        x = "Workshop Attended",
        title = "Marjority of Data Carpentry Respondents \nAttend Ecology Workshops"
    )
```

```{r dc-workshop-type-lolli}

ggassessment_lolli(dc_workshop_type,
                   aes(x = factor(workshop, levels = rev(workshop_types)),
                       y = percent,
                       xend = factor(workshop, levels = rev(workshop_types)))) +
      labs(
          x = "Workshop Attended",
          title = "Marjority of Data Carpentry Respondents \nAttend Ecology Workshops"
      )

```	

```{r dc-workshop-language}	
## Language covered 
## Data Carpentry: Which programming language is being covered?
workshop_language <- c("R", "Python", "I don't know/I don't remember",
                       "Neither", "Didn't answer")

dc_programming_language <- dcpostdata %>%
    single_answer_summary(programming_language, workshop_language)

dc_programming_language_r <- dc_programming_language %>%
    filter(programming_language == "R") %>%
    pull(percent)

dc_programming_language_py <- dc_programming_language %>%
    filter(programming_language == "Python") %>%
    pull(percent)

dc_programming_language %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c ("Data Carpentry: Language Covered in Workshops", "n", "%"))

```

As previously mentioned, Data Carpentry workshops are domain specific, and
curricula include Ecology, Genomics, Geospatial, Social Sciences, and
Reproducible Research. `r dc_programming_language_r`% of respondents learned R
in their workshop, while `r dc_programming_language_py`% learned Python.



## Workshop Environment


```{r workshop-environment}
# Environment
# Data Carpentry: I felt comfortable learning in this workshop environment

comfortable_levels <- c("Strongly disagree", "Disagree", "Neutral", "Agree",
                        "Strongly agree", "Didn't answer")
atmosphere_levels <- c("Strongly Disagree", "Disagree",
                       "Neither Agree nor Disagree", "Agree", "Strongly Agree",
                      "Didn't answer")

dc_comfortable <- dcpostdata %>%
    single_answer_summary(comfortable, comfortable_levels)

dc_comfortable_percent_agree <- dc_comfortable %>%
    filter(comfortable %in% c("Agree", "Strongly agree")) %>%
    summarize(p = sum(percent)) %>%
    pull(p)
    
swc_comfortable <- swcpostdata %>%
    single_answer_summary(atmosphere, atmosphere_levels)

swc_comfortable_percent_agree <- swc_comfortable %>%
    filter(atmosphere %in% c("Agree", "Strongly Agree")) %>%
    summarize(p = sum(percent)) %>%
    pull(p)
```

The Carpentries is committed to making participation in our workshops a
harassment-free experience for everyone, regardless of who you are, where you
come from, or your experience with the tools we teach. We establish norms for
interaction by having, discussing, and enforcing a Code of Conduct such that our
workshops provide open and inclusive learning environments. `r
dc_comfortable_percent_agree`% of Data Carpentry respondents either agree or
strongly agree that they felt comfortable learning in their workshop
environment, and `r swc_comfortable_percent_agree`% of Software Carpentry's
respondents agreed or strongly agreed the workshop atmosphere was welcoming.


```{r dc-post-workshop-comfortable-environment}
## Data Carpentry plot for workshop environment
ggassessment_hist(dc_comfortable, 
                  aes(x = factor(comfortable, levels = comfortable_levels), 
           y = percent)) +
    labs(
        x = "Level of Agreement", 
        main = "Data Carpentry Respondents felt comfortable learning \n in their workshop environment"
    )
```

```{r swc-post-workshop-environment}
# Software Carpentry plot for workshop environment
ggassessment_hist(swc_comfortable, 
                  aes(x = factor(atmosphere, levels = atmosphere_levels),
                      y = percent)) +
    labs(
        x = "Level of Agreement", 
        main = "Software Carpentry Respondents felt the workshop \natmosphere was welcoming"
    )
```

Data Carpentry respondents were asked to rate their level of agreement with several statements regarding their instructor's knowledge, instructional method, and enthusiasm. Their responses are in the figure below, and axis labels correspond to the statements as follows:

+ __Instructors Knowledge__: The instructors were knowledgeable about the material being taught.
+ __Instructors Interacting__: I felt comfortable interacting with the instructors. 
+ __Instructors Enthusiastic__: The instructors were enthusiastic about the workshop.
+ __Instructors Clear Answers__: I was able to get clear answers to my questions from the instructors. 

```{r likert-helpers}
transform_likert_labels <- function(.data) {
    .data$results$Item <- convert_label(.data$results$Item)
    names(.data$items) <- convert_label(names(.data$items))
    .data
}
```


```{r dc-perception-instructors-data}
## Perception of instructors and helpers
## Data Carpentry
perception_levels <- c("Strongly disagree", "Disagree", "Neutral", "Agree",
                       "Strongly agree")

dc_perception_instructors <- dcpostdata %>%
    select(starts_with("instructors"),
           -instructors_open_ended) %>%
    filter(has_answers(.))

dc_perception_percent_agree <- dc_perception_instructors %>%
    summarize_all(~ sum(. %in% c("Agree", "Strongly agree"))/length(.)) %>%
    gather(skill, percent) %>%
    mutate(percent = round(percent * 100, 1))

dc_perception_instructors_interacting <- dc_perception_percent_agree %>%
    filter(skill == "instructors_interacting") %>%
    pull(percent)

dc_perception_instructors_clear_answers <- dc_perception_percent_agree %>%
    filter(skill == "instructors_clear_answers") %>%
    pull(percent)

dc_perception_instructors_knowledge <- dc_perception_percent_agree %>%
    filter(skill == "instructors_knowledgeable") %>%
    pull(percent)

dc_perception_instructors_enthusiastic <- dc_perception_percent_agree %>%
    filter(skill == "instructors_enthusiastic") %>%
    pull(percent)

dc_perception_instructors_likert <- dc_perception_instructors %>% 
    mutate_all(~ factor(., levels = perception_levels, ordered = TRUE)) %>%
    as.data.frame() %>% 
    likert() %>%
    transform_likert_labels()
```

```{r dc-perception-instructors-heatmap}
## Data Carpentry
## Heatmap for Data Carpentry perception of instructors and helpers
title <- "Perception of Data Carpentry Instructors"

plot(dc_perception_instructors_likert,
     type = "heat",
     panel.arrange = NULL, panel.strip.color = "darkcyan",
     legend.position = "bottom") +
    ggtitle(title)
```

The largest impact we see is that `r dc_perception_instructors_interacting`% of respondents said they felt comfortable interacting with the instructors. We know that our instructors *are* the reason why our workshops are so well received. It's also great to see that `r dc_perception_instructors_knowledgeable`% and `r dc_perception_instructors_enthusiastic`% of respondents felt our instructors were knowledgeable about the material being taught, and were enthusiastic about the workshop, respectively. We would like to explore what training would help our instructors so that the percentage of respondents who felt they were able to get clear answers to their questions from the instructors would increase.

Software Carpentry respondents were asked to rate how they felt instructors and helpers worked as a team based on the following criteria:

+ __Considerate__: Instructors/Helpers were considerate.
+ __Enthusiastic__: Instructors/Helpers were enthusiastic. 
+ __Clear Answers__: Instructors/Helpers gave clear answers to your questions. 
+ __Communicators__: Instructors/Helpers were good communicators.    
  
The two Likert plots below provide an analysis of respondent's answers for both instructors and helpers.

```{r swc-perception-instructors}	
## Software Carpentry: Perception of SWC workshop instructors/helpers
frequency_levels <- c("Never", "Rarely", "Sometimes", "Often",
                      "All of the time")

swc_instructor_perception <- swcpostdata %>%
    select(starts_with("instructors")) %>%
    filter(has_answers(.))

swc_instructor_perception_likert <- swc_instructor_perception %>% 
    mutate_all(~ factor(., levels = frequency_levels, ordered = TRUE)) %>%
    as.data.frame() %>% 
    likert() %>%
    transform_likert_labels()    

## Software Carpentry Instructors Plot
plot(swc_instructor_perception_likert) +
    ggtitle("Perception of Software Carpentry Instructors")
```

```{r swc-perception-helpers}
swc_helper_perception_likert <- swcpostdata %>%
    select(starts_with("helpers")) %>%
    filter(has_answers(.)) %>%
    mutate_all(~ factor(., levels = frequency_levels, ordered = TRUE)) %>%
    as.data.frame() %>% 
    likert() %>%
    transform_likert_labels()

## Software Carpentry: Helpers Plot
plot(swc_helper_perception_likert) +
    ggtitle("Perception of Software Carpentry Helpers")
```

From the figures above, we see that Software Carpentry instructors and helpers are considerate, enthusiastic, give clear answers to questions, and are good communicators. As a whole, our instructors work as a team and are successful in creating a warm and welcoming workshop environment.


```{r dc-skill-applicability}
## Data Carpentry: I can immediately apply what I learned at this workshop
applicability_levels <- c("Strongly disagree", "Disagree", "Neutral", "Agree",
                          "Strongly agree", "Didn't answer")

dc_applicability <- dcpostdata %>%
    single_answer_summary(immediately_apply, applicability_levels)

dc_applicability_percent <- dc_applicability %>%
    filter(immediately_apply %in% c("Agree", "Strongly agree")) %>%
    summarize(p = sum(percent)) %>%
    pull(p)
```

One of the goals for Data Carpentry's lessons is that learners are able to
immediately apply what they learned at the workshop. The figure below shows that
`r dc_applicability_percent`% either agree or strongly agree that they're able
to immediately apply what they learned.


```{r dc-skill-applicability-plot}
ggassessment_hist(dc_applicability,
                  aes(x = factor(immediately_apply,
                                 levels = applicability_levels),
                      y = percent)) +
    labs(
        x = "Level of Agreement",
        title = "Data Carpentry respondents can immediately apply \nwhat they learned at the workshop" 
    )
```


```{r swc-new-info}
## How much information was new??? 
## Software Carpentry: How much information presented at the SWC workshop was
## new.
swcpostdata$new_information <- iconv(swcpostdata$new_information,
                                     "latin1", "ASCII", sub=" ")
swcpostdata$new_information <- gsub("\\s+", " ", swcpostdata$new_information)

newinfo_levels <- c("None of it", "Some of it", "About half of it",
                    "Most of it", "All of it", "Didn't answer")

swc_new_info <- swcpostdata %>%
    single_answer_summary(new_information, newinfo_levels)


swc_new_info_percent <- swc_new_info %>%
    filter(new_information %in% c("Most of it", "All of it")) %>%
    summarize(p = sum(percent)) %>%
    pull(p)

```

As the majority of Software Carpentry learners attend workshops to learn new skills it is great to see that `r swc_new_info_percent`% of learners either learned mostly or all new information during the workshop.



```{r swc-new-information-plot}
# Software Carpentry plot for new information
ggassessment_hist(swc_new_info,
                  aes(x = factor(new_information, levels = newinfo_levels), 
                      y = percent)) +
    labs(
        x = "How much information was new?",
        title = "Software Carpentry Respondents Learned \nMostly New Information"
    )
```

### Workshop Experience


```{r dc-accessibility}
## Accessibility Data Carpentry: Were there any accessibility issues that
## affected your ability to participate in this workshop?
dc_accessibility <- dcpostdata %>%
    single_answer_summary(accessibility_issues, c("No", "Yes", "Didn't answer"))

dc_accessibility_percent <- dc_accessibility %>%
    filter(accessibility_issue == "Yes") %>%
    pull(percent)

dc_accessibility %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c("Data Carpentry Respondents Having Accessibility Issues", "n", "%"))
```

We want to be proactive in ensuring learners have access to whatever they need to participate in a workshop. Both Data and Software Carpentry learners are asked to inform workshop organizers if there is anything they need that would make their workshop experience better. Data Carpentry's respondents were asked if they had accessibility issues, and `r dc_accessibility_percent`% reported they did. After reading the open-ended responses, we see that the issues were related to not being able to hear and/or see in the back of the room.


```{r dc-nps}
compute_nps <- . %>%
    pull(likely_to_recommend) %>%
    as.numeric() %>% 
    npc(breaks = list(0:64, 65:84, 85:100)) %>%
    data_frame(category = .) %>%
    mutate(category = as.character(category),
           category = replace_na(category, "Didn't answer")) %>% 
    count(category) %>%
    mutate("%" = round(n / sum(n) * 100, 1)) %>%
    arrange(category = factor(category,
                              levels = c("Promoter", "Passive",
                                         "Detractor", "Didn't answer")))
compute_nps_percent <- . %>%
    filter(category != "Didn't answer") %>%
    mutate(p = round(n / sum(n) * 100, 1)) %>%
    filter(category == "Promoter") %>% 
    pull(p) 


## NPS 
## Data Carpentry
dc_nps  <- dcpostdata %>%
    compute_nps

dc_nps %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c ("Data Carpentry Net Promoter Score", "n", "%"))

dc_nps_promoters <- dc_nps %>%
    compute_nps_percent
```

We use the [Net Promoter Score](https://en.wikipedia.org/wiki/Net_Promoter) to measure learners' likelihood of recommending workshops to a friend or colleague. The scoring for this question is on a 0 to 100 scale. Respondents scoring from 0 to 64 are labeled *Detractors*, and are believed to be less likely to recommend a workshop. Those who respond with a score of 85 to 100 are called *Promoters*, and are considered likely to recommend a workshop. Respondents between 65 and 84 are labeled *Passives*, and their behavior falls in the middle of Promoters and Detractors.

`r dc_nps_promoters`% of Data Carpentry respondants who answered this question are promoters (i.e. would recommend a workshop). 


```{r swc-nps}
# NPS
# Software Carpentry
swc_nps <- swcpostdata %>%
    mutate(likely_to_recommend = as.numeric(likely_to_recommend) * 10) %>%
    compute_nps

swc_nps_percent <- swc_nps %>%
    compute_nps_percent
```

For Software Carpentry respondents who answered this questions, `r swc_nps_percent`% are promoters.

```{r}
## Qualitative Analysis (SWC/DC)
```

In summary, Data and Software Carpentry workshops provide a warm and welcoming environment whether learners are brand new to programming or have some experience. Attendees are recommending workshops to their friends and colleagues, and we know that our instructors and helpers are the major reason why.

### Effect of Workshops on Learners Self-Reported Perspectives: Skills & Confidence

Learners were asked to rate their level of agreement with the following statements related to Data Carpentry's workshop goals and learning objectives. The figure below provides a visual representation of their responses, comparing them before the workshop and after the workshop. Axis labels and the corresponding question are as follows:  

+ __Write Program__: I can write a small program/script/macro to solve a problem in my own work. 
+ __Search Online__: I know how to search for answers to my technical questions online.
+ __Raw Data__: Having access to the original, raw data is important to be able to repeat an analysis.
+ __Programming Efficient__: Using a programming language (like R or Python) can make me more efficient at working with data.
+ __Programming Confident__: I am confident in my ability to make use of programming software to work with data.
+ __Overcome Problem__: While working on a programming project, if I get stuck, I can find ways of overcoming the problem.
+ __Analyses Easier__: Using a programming language (like R or Python) can make my analyses easier to reproduce. 
 

```{r dc-paired-data}
## Data Carpentry
## Ability to perform various computing tasks before and after completing the workshop
## Paired analysis plot to compare DC pre scores with post scores
prep_paired_data <- . %>%
    select(unique_id, raw_data:programming_efficient) %>%
    filter(!is.na(unique_id)) %>%
    gather(skill, feeling, -unique_id) %>%
    mutate(feeling_score = case_when(
               feeling == "Strongly disagree" ~ 1,
               feeling == "Disagree"          ~ 2,
               feeling == "Neutral"           ~ 3,
               feeling == "Agree"             ~ 4, 
               feeling == "Strongly agree"    ~ 5,
               is.na(feeling)                 ~ NA_real_, 
               TRUE                           ~ 999
           )) %>%
    assert(in_set(NA, 1, 2, 3, 4, 5), feeling_score)


pre_paired <- dcpredata %>%
    prep_paired_data %>%
    rename_at(vars(-unique_id, -skill), ~ paste0("pre_", .))
    
post_paired <- dcpostdata %>%
    prep_paired_data %>%
    rename_at(vars(-unique_id, -skill), ~ paste0("post_", .))

paired_data <- inner_join(pre_paired, post_paired, by = c("unique_id", "skill"))
```

```{r dc-paired-data-mode}
dist_mode <- function(x) {
    ux <- unique(x)
    ux[which.max(tabulate(match(x, ux)))]
}


paired_data %>%
    select(unique_id, skill,
           pre_feeling_score,
           post_feeling_score) %>%
    filter(!is.na(pre_feeling_score) & !is.na(post_feeling_score)) %>% 
    gather(score, type, -unique_id, -skill) %>%
    mutate(skill = convert_label(skill)) %>%
    group_by(skill, score) %>%
    summarize(
        mode = dist_mode(type),
        sd = sd(type, na.rm = TRUE)
    ) %>% 
    ggplot(aes(x = skill, y = mode, color = score)) +
    geom_point(size=5) +
    coord_flip() +
    ylim(c(0, 5)) +
    theme_minimal() +
    scale_color_viridis(breaks = c("pre_feeling_score", "post_feeling_score"),
                        labels = c("Pre-workshop Score",
                                   "Post-workshop Score"), 
                        end = .7, discrete=TRUE) +
    labs(title = "Pre and Post Comparison of Skills and Perception") +
    theme(text = element_text(size = 16))
```


```{r dc-paired-data-mean}
paired_data %>%
    select(unique_id, skill,
           pre_feeling_score,
           post_feeling_score) %>%
    filter(!is.na(pre_feeling_score) & !is.na(post_feeling_score)) %>% 
    gather(score, type, -unique_id, -skill) %>%
    mutate(skill = convert_label(skill)) %>%
    group_by(skill, score) %>%
    summarize(
        mean = mean(type, na.rm = TRUE),
        sd = sd(type, na.rm = TRUE)
    ) %>% 
    ggplot(aes(x = skill, y = mean, color = score)) +
    geom_point(size=5) +
    coord_flip() +
    ylim(c(0, 5)) +
    theme_minimal() +
    scale_color_viridis(breaks = c("pre_feeling_score", "post_feeling_score"),
                        labels = c("Pre-workshop Score",
                                   "Post-workshop Score"), 
                        end = .7, discrete=TRUE) +
    labs(title = "Pre and Post Comparison of Skills and Perception") +
    theme(text = element_text(size = 16))

```




As the scoring for the above factors is ordinal from strongly disagree (1) to strongly agree (5), we show the mode (most frequent responses) for respondents' before the workshop, and after the workshop. If there is only one point on the plot it is because the mode for pre- and post-workshop responses was the same. The comparison above is paired, meaning, we are comparing those who provided us with a unique identifier and who completed both the pre- and post-workshop survey. This figure includes XX respondses.

In the figures below we show another representation of the pre- and post-comparison of respondents skills and perspectives. The figures below include the data for all learners, not only those who provided a unique identifier *and* took both the pre- and post-workshop surveys. What we see is a shift in the distribution of for each factor, meaning, respondents' self-reported confidence and ability shifted in a positive directions.



```{r distribution-shift}

paired_data %>%
    select(UniqueID, skill,
           pre = pre_feeling_score, post = post_feeling_score) %>%
    filter(!is.na(pre) & !is.na(post)) %>%
    gather(pre_post, score, -UniqueID, -skill) %>%
    count(skill, pre_post, score) %>%
    group_by(skill, pre_post) %>%
    mutate(n_total = sum(n),
           percent = n/n_total * 100) %>%
    ungroup() %>%
    mutate(skill = gsub("([a-z])([A-Z])", "\\1 \\2", skill)) %>%
    mutate(pre_post = factor(pre_post, levels = c("pre", "post"))) %>%
    ggplot(aes(x = score, y = percent, group = pre_post)) +
    geom_col(aes(fill = pre_post),
             position = "dodge") +
    geom_text(aes(label = n, y = percent + 3), position = position_dodge(0.9),
              ) +
    facet_wrap(~ skill) +
    scale_fill_viridis(
        name = "",
        breaks = c("pre", "post"),
        labels = c("Pre-workshop", "Post-workshop"),
        discrete = TRUE, end = .7) +
    theme_minimal()

```


Another representation of the positive shift in distribution is provided below.

```{r, fig.height=16}
paired_data %>%
    mutate(diff_score = post_feeling_score- pre_feeling_score) %>%
    filter(!is.na(diff_score)) %>% 
    mutate(diff_score = factor(diff_score)) %>%
    mutate(skill = gsub("([a-z])([A-Z])", "\\1 \\2", skill)) %>%
    count(skill, diff_score) %>%
    group_by(skill) %>%
    mutate(total = sum(n),
           prop = n/total) %>% 
    ggplot(aes(x = diff_score, y = prop, fill = diff_score))+
    geom_col() +
    theme_minimal() +
    facet_grid(skill ~ .) +
    labs(title = "Distribution of the change in scores before and after workshop") +
    scale_fill_viridis(name = "score difference", discrete = TRUE) +
    theme(legend.position = "top")
```

```{r include=FALSE}
# Data Carpentry paired analysis table to compare DC pre scores with post scores
# I will not include this table in the report as we cannot
# report mean and p-values for ordinal variables
t_test_results <- paired_data %>%
    group_by(skill) %>%
    nest() %>% 
    mutate(t_test_res = purrr::map(data, function(x) {
        t.test(x$pre_feeling_score, x$post_feeling_score, paired = TRUE,
               alt = "less") %>%
            broom::tidy()
    })) %>%
    unnest(t_test_res)

t_test <- paired_data %>%
    group_by(skill) %>%
    summarize(
        mean_pre_feeling = mean(pre_feeling_score, na.rm = TRUE),
        n_pre = sum(!is.na(pre_feeling_score)),
        sd_pre_feeling = sd(pre_feeling_score, na.rm = TRUE),
        mean_post_feeling = mean(post_feeling_score, na.rm = TRUE),
        n_post = sum(!is.na(post_feeling_score)),
        sd_post_feeling = sd(post_feeling_score, na.rm = TRUE)
    ) %>%
    left_join(t_test_results, by = "skill")

kable(select(t_test, skill, ends_with("feeling"), starts_with("n"), 
             p.value))
 
```

The neutral centered graphs below provide an even clearer picture of the shift in respondents self-reported confidence and skills. 

It is interesting to see the shift in neutrality between the pre-workshop scores and post-workshops scores, especially for *Programming Efficient*. There was a higher percentage of learners beginning the workshop who felt programming with R or Python can make them more efficient at working with data. Contrarily, confidence in using programming to work with data increased from XX% to xx%.

```{r}
# Data Carpentry pre-workshop neutral centered graph code
ordered_agree <-
   c("Strongly disagree",
   "Disagree",
   "Neutral",
   "Agree",
   "Strongly agree")

likert_cols <- 
    dcpredata %>% 
    select(which(map_lgl(dcpredata, ~`%in%`("Agree", .x)))) %>% 
    mutate_if(is.character, as.factor) %>% 
    mutate_all(funs(fct_relevel(., ordered_agree))) %>% 
    filter_all(all_vars(!is.na(.)))

lc <- likert(data.frame(likert_cols))
```

```{r dc_pre_perception_likert}
# Data Carpentry pre-workshop neutral centered graph
lc <- likert(data.frame(likert_cols))
title <- "Data Carpentry Respondents: Pre-Workshop Perception of Tools"
theme_update(plot.title = element_text(hjust = 0.5))

likert_pre <- plot(lc) +
    ggtitle(title)+ 
    guides(fill = guide_legend(nrow = 2)) # wraps legend

## Double check the plot with a table:
xx <- 
    likert_cols %>% 
    gather(key, value) %>% 
    group_by(key, value) %>% 
    tally() %>% 
    mutate(perc = round(n / sum(n) * 100, 1)) %>% 
    select(-n) %>% 
    spread(key, perc) %>% 
    slice(match(ordered_agree,
                value))
``` 

```{r}
# Data Carpentry post-workshop neutral centered graph code
ordered_agree <-
   c("Strongly disagree",
   "Disagree",
   "Neutral",
   "Agree",
   "Strongly agree")

likert_cols <- 
    dcpostdata %>%
    select(which(map_lgl(dcpostdata, ~`%in%`("Agree", .x)))) %>%
    select(-matches("Instructor"), -matches("Comfortable"),
           -matches("WorkWithData"), -matches("Immediately")) %>%
    mutate_if(is.character, as.factor) %>% 
    mutate_all(funs(fct_relevel(., ordered_agree))) %>% 
    filter_all(all_vars(!is.na(.)))

```

```{r dc_post_perception_likert}
# Data Carpentry post-workshop neutral centered graph
lc <- likert(data.frame(likert_cols))

lc$results$Item <-  gsub("([a-z])([A-Z])", "\\1 \\2",
                         lc$results$Item)

names(lc$items) <-  gsub("([a-z])([A-Z])", "\\1 \\2",
                         names(lc$items))


title <- "Data Carpentry Respondents: Post-Workshop Perception of Tools"
theme_update(plot.title = element_text(hjust = 0.5))

likert_post <- plot(lc) +
    ggtitle(title)+ 
    guides(fill = guide_legend(nrow = 2)) # wraps legend


## Double check the plot with a table:
xx <- 
    likert_cols %>% 
    gather(key, value) %>% 
    group_by(key, value) %>% 
    tally() %>% 
    mutate(perc = round(n / sum(n) * 100, 1)) %>% 
    select(-n) %>% 
    spread(key, perc) %>% 
    slice(match(ordered_agree,
                value))

```


```{r dc_pre_post_likert, fig.height=16}

(likert_pre + theme(legend.position="none"))  +
    likert_post +
    plot_layout(ncol=1)

```

Software Carpentry Respondets were asked to tell us about their experience with these topics before the workshop:

+ R
+ Unix Shell
+ SQL
+ Python
+ Version Control with Git

```{r}
# Software Carpentry
ordered_little <-
  c("Little or no knowledge of topic",
    "Some knowledge of topic",        
    "Extensive knowledge of topic")  # yours doesn't match the data

likert_cols_little <- 
 swcpostdata %>% 
   select(which(map_lgl(swcpostdata, ~`%in%`("Little or no knowledge of topic", .x)))) %>% 
   mutate_if(is.character, as.factor) %>% 
   mutate_all(funs(fct_relevel(., ordered_little))) %>% 
  filter_all(all_vars(!is.na(.))) 

# To relabel the y-axis, remove the '-Pre like this:"

names(likert_cols_little) <- gsub("-Pre", "", names(likert_cols_little) )

lc_little <- likert(data.frame(likert_cols_little))
```

From the figure we see that XX% and less had extensive knowledge of the topics covered in their workshop.

```{r swc_pre_knowledge}
plot(lc_little) +
  ggtitle("Software Carpentry Self-Reported Knowledge of Tools Covered Pre-Workshop") + 
guides(fill = guide_legend(nrow = 2)) # wraps legend

# Double check the plot with a table:
xx <- 
likert_cols_little %>% 
  gather(key, value) %>% 
  group_by(key, value) %>% 
  tally() %>% 
  mutate(perc = round(n / sum(n) * 100, 1)) %>% 
  select(-n) %>% 
  spread(key, perc) %>% 
  slice(match(ordered_little,
              value))
```


```{r}
# Software Carpentry
# Pre/Post plots for knowledge and perception of tools covered
# Because the pre- and post- columns are quite different, we
# cannot put them on the same plot. So let's do two plots then stack them up
# Use grid.arrange(), nest(), and map() to combine the pre/post plots
  
  knowledge_pre <-
    c(
    "Little or no knowledge of topic",
    "Some knowledge of topic",
    "Extensive knowledge of topic"
    )

knowledge_post <- 
  c("No increase in my knowledge", 
    "Knowledge increased slightly", 
    "Knowledge increased a little", 
    "Knowledge increased a great deal")

# Compute for all tools.

# Before the workshop
pre_knowledge <- 
swcpostdata %>%
  select(contains("Pre")) %>% 
  gather() %>% 
  filter(value %in% knowledge_pre) %>% 
  nest(-key) %>% 
  mutate(tallies = purrr::map(data, ~tally_and_perc(.x, value))) %>% 
  unnest(tallies) %>% 
  mutate(key = gsub("Pre", "", key))

# After the workshop
post_knowledge <- 
swcpostdata %>%
  select(contains("Increase")) %>% 
  gather() %>% 
  filter(value %in% knowledge_post) %>% 
  nest(-key) %>% 
  mutate(tallies = purrr::map(data, ~tally_and_perc(.x, value)))  %>% 
  unnest(tallies) %>% 
  mutate(key = gsub("Increase", "", key))

# Plot before and after as two grouped bar plots, then combine.

tools_before <- 
   ggplot(pre_knowledge, 
         aes(x = key,
             y = `%`,
             fill = fct_relevel(value, 
                             knowledge_pre))) +
    geom_col(position = "dodge") +
    geom_text(aes(label=n), 
              size= 4,
              position=position_dodge(width=1)) +
    scale_x_discrete(labels = function(x) lapply(strwrap(x,
                                                         width = 10,
                                                         simplify = FALSE),
                                                 paste,
                                                 collapse = "\n")) +
    theme_classic() +
    xlab("") +
    ylab("% Respondents") +
    ggtitle("Knowledge before workshop") +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme_classic(base_size = 14) +
    theme(legend.position = "bottom", 
          legend.title=element_blank()) + 
guides(fill = guide_legend(nrow = 2)) # wraps legend

tools_after <- 
   ggplot(post_knowledge, 
         aes(x = key,
             y = `%`,
             fill = fct_rev(fct_relevel(value, 
                             (knowledge_pre))))) +
    geom_col(position = "dodge") +
    geom_text(aes(label=n), 
              size= 4,
              position=position_dodge(width=1)) +
    scale_x_discrete(labels = function(x) lapply(strwrap(x,
                                                         width = 10,
                                                         simplify = FALSE),
                                                 paste,
                                                 collapse = "\n")) +
    theme_classic() +
    xlab("") +
    ylab("% Respondents") +
    ggtitle("Knowledge after workshop") +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme_classic(base_size = 14) +
    theme(legend.position = "bottom", 
          legend.title=element_blank()) + 
guides(fill = guide_legend(nrow = 2)) # wraps legend
          
```


The following is a comparison of Software Carpentry Respondents' knowledge about the tools before compared to after the workshop. We see clearly that after the workshop, respondents' knowledge of Git, Python, R, and the Unix Shell increased a great deal.

```{r swc_prepost_knowledge}
# put the two plots together
library(gridExtra)
grid.arrange(tools_before, 
             tools_after,
             ncol = 1) 
```

### Respondent Ability to Perform Computing Tasks
Motivation is important, but being confident in your ability to complete specific computing tasks is an equally important goal of Software Carpentry. The grid below shows respondents' self-reported ability to complete tasks including: 

* Using pipes to connect shell commands 
* Writing a 'for loop' to automate tasks   
* Initializing a repository with git 
* Writing a function 
* Importing a library or package in R or Python 
* Writing a unit test in Python or R 
* Writing an SQL query 

It also provides their self-reported level of confidence in being able to complete the tasks above after completing the workshop. 

These figures tell us that, before the workshop, between XX% and XX% of the respondents did not feel they could initialize a repository in Git, write a 'for loop' to automate tasks, use pipes to connect shell commands, write a SQL query, and/or write a unit test in R or Python. XX% of learners felt their confidence increased greatly with respect to importing a library or package in R or Python. We consider this significant as it is one of the fundamental skills that allows learners to be successful in the other areas mentioned above.

In summary, respondents experienced increased confidence in their ability to perform specific computing tasks and solve problems, or at least search for answers to problems, as a result of participating in Software and Data Carpentry workshops.

```{r}
# Software Carpentry
# Code chunk for ability to perform various computing tasks
computing_pre <-
    c(
    "Yes",
    "No",
    "Maybe"
    )

computing_post <- 
  c("Confidence increased slightly", 
    "Confidence increased a bit", 
    "Confidence increased greatly", 
    "No change in confidence",
    "N/A - Not covered at workshop")

# Compute for all tools.

# Before the workshop
pre_computing <- 
swcpostdata %>%
  select(contains("Before")) %>% 
  gather() %>% 
  filter(value %in% computing_pre) %>% 
  nest(-key) %>% 
  mutate(tallies = purrr::map(data, ~tally_and_perc(.x, value))) %>% 
  unnest(tallies) %>% 
  mutate(key = gsub("Before", "", key))

# After the workshop
post_computing <- 
swcpostdata %>%
  select(contains("After")) %>% 
  gather() %>% 
  filter(value %in% computing_post) %>% 
  nest(-key) %>% 
  mutate(tallies = purrr::map(data, ~tally_and_perc(.x, value)))  %>% 
  unnest(tallies) %>% 
  mutate(key = gsub("After", "", key))

# Plot before and after as two grouped bar plots, then combine.

computing_before <- 
   ggplot(pre_computing, 
         aes(x = key,
             y = `%`,
             fill = fct_relevel(value, 
                             computing_pre))) +
    geom_col(position = "dodge") +
    geom_text(aes(label=n), 
              size= 4, 
              position=position_dodge(width=1)) +
    scale_x_discrete(labels = function(x) lapply(strwrap(x,
                                                         width = 10,
                                                         simplify = FALSE),
                                                 paste,
                                                 collapse = "\n")) +
    theme_classic() +
    xlab("") +
    ylab("% Respondents") +
    ggtitle("Respondent Ability Pre-Workshop") +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme_classic(base_size = 14) +
    theme(legend.position = "bottom", 
          legend.title=element_blank()) 

computing_after <- 
   ggplot(post_computing, 
         aes(x = key,
             y = `%`,
             fill = fct_rev(fct_relevel(value, 
                             (computing_pre))))) +
    geom_col(position = "dodge") +
    geom_text(aes(label=n), 
              size= 4,
              position=position_dodge(width=1)) +
    scale_x_discrete(labels = function(x) lapply(strwrap(x,
                                                         width = 10,
                                                         simplify = FALSE),
                                                 paste,
                                                 collapse = "\n")) +
    theme_classic() +
    xlab("") +
    ylab("% Respondents") +
    ggtitle("Level of Confidence Post-Workshop") +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme_classic(base_size = 14) +
    theme(legend.position = "bottom", 
          legend.title=element_blank()) + 
guides(fill = guide_legend(nrow = 2)) # wraps legend
          
```

```{r swc_prepost_confidence}
# Put the two plots together
library(gridExtra)
grid.arrange(computing_before, 
             computing_after,
             ncol = 1)
```


### Demographics
The Carpentries is a global community that has recognized the importance of bringing people to data through high-impact trainings. Thought the majority of Data Carpentry respondents attended a workshop in the United States of America (XX%), we see an increase in workshops in places like Ethiopia (XX%), Switzerland (XX%), and India (XX%).   
```{r}
# In this section we will include
# Workshop Location (DC): 
# Domain (SWC, DC)
# Position (SWC, DC)
# OS (DC)
# 1st time attending (SWC)
# Gender/Ethnicity (DC)
```

```{r}
# Data Carpentry learners are asked what country their workshop is held.
# Tally Data Carpentry's pre-workshop respondents by Country
dcpredata_country_tally <-
dcpredata %>%
  group_by(Country) %>%
  tally(sort = TRUE) %>%
  mutate(perc = round(100 * (n/sum(n)), 1)) %>% # add the % col
  filter(!is.na(Country)) %>%
  arrange(desc(n))
```

```{r dc_respondents_by_country}
# Plot Data Carpentry's respondents by Country
ggplot(dcpredata_country_tally,
       aes(reorder(Country, perc),
           perc)) +
  geom_bar(stat = "identity", fill = "maroon") +
  theme_classic() +
  xlab("") +
  ylab("Percentage of Respondents") +
  coord_flip() +
  ggtitle("Breakdown of Data Carpentry's Survey \nRespondents by Country") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_bw(base_size = 14)
#kable(data_country_tally, format='markdown')
```

In Software Carpentry's pre-workshop survey, respondents are asked whether or not their workshop takes place in the United States. XX% of respondents attended a U.S. workshop.

```{r}
# Tally Software Carpentry's pre-workshop respondents by Country
swcpredata_country_tally <-
    swcpredata %>%
    mutate(USWorkshop = replace(USWorkshop, is.na(USWorkshop),
                                "Didn't answer")) %>% 
    group_by(USWorkshop) %>%
    tally(sort = TRUE) %>%
    mutate(perc = round(100 * (n/sum(n)), 1)) %>% # add the % col
    arrange(desc(n))


kable(swcpredata_country_tally, format='markdown', col.names = c("Software Carpentry Workshops in US", "n", "%"))
```

As previously mentioned, Data Carpentry's curricula is domain specific to Ecology, Genomics, Geospatial, and the Social Sciences. We see this in the distribution of respondents by discipline. XX% are in the Life Science, while XX%, XX%, and XX% are in Agricultural or Environmental Sciences, Bioinformatics/Genomics, and Biomedical/Health Sciences, respectively.

```{r}
## Domain 
## Tally Data Carpentry's pre-workshop respondents by Discipline
## Responses are in columns 'Discipline' through 'Column13'
dcdiscipline <-
    dcpredata %>%
 select(Discipline:Column13) %>%
 gather(col, dcdiscipline) %>%
 group_by(dcdiscipline) %>%
 tally_and_perc(dcdiscipline, na.rm = TRUE) %>%
 filter(!is.na(dcdiscipline)) %>%
 arrange(desc(n)) %>%
 rename(`Discipline` = dcdiscipline)

kable(dcdiscipline, format = 'markdown', row.names = NA, col.names = c ("Data Carpentry's Respondents by Discipline", "n", "%"))
```

Software Carpentry's respondent base also has a majority Life Sciences base (XX%), however we also see representation from those working in Psychology, High Performance Computing, and Chemistry.

```{r}
# Tally Software Carpentry's pre-workshop respondents by Discipline
# Responses are in columns 'Domain' through 'Column61'
swcdiscipline <-
 swcpredata %>%
 select(Domain:Column61) %>%
 gather(col, swcdiscipline) %>%
 group_by(swcdiscipline) %>%
 tally_and_perc(swcdiscipline,na.rm = TRUE) %>%
 filter(!is.na(swcdiscipline)) %>%
 arrange(desc(n)) %>%
 rename(`Domain` = swcdiscipline)

kable(swcdiscipline, format = 'markdown', row.names = NA, col.names = c ("Software Carpentry's Respondents by Discipline", "n", "%"))
```

As many of The Carpentries' workshops are hosted on college campuses and other research-based communities, there is no surprise that the majority of respondents are Graduate Students (XX% - DC, XX% - SWC), Research Staff (XX% - DC, XX% - SWC), and Postdoctoral Researchers (XX% - DC, XX% - SWC).
```{r}
# Position/Status
# Data Carpentry Respondents by Status
# Responses are in columns 'Status' through 'Column22'
ordered_status = c("Undergraduate Student", "Graduate Student", "Postdoctoral Researcher", "Faculty", "Industry Employee", "Government Employee", "Research Staff", "Management/Administrator", "Retired/Not Employed", "Other (please specify)")

dcpredata_status_tally <-
 dcpredata %>%
 select(Status:Column22) %>%
 gather(col, dcpredata_status_tally) %>%
 group_by(dcpredata_status_tally) %>%
 tally_and_perc(dcpredata_status_tally, na.rm = TRUE) %>%
 filter(!is.na(dcpredata_status_tally)) %>%
 arrange(desc(n)) %>%
 rename(`Status` = dcpredata_status_tally)

kable(dcpredata_status_tally, format = 'markdown', row.names = NA, col.names = c ("Data Carpentry's Respondents by Position", "n", "%"))
```

```{r dc_learners_status}
# Data Carpentry plot of learners by position/status
# This plot is not working
ggplot(dcpredata_status_tally, 
       aes(Status,
           y = `%`,
           n)) +
  geom_bar(stat = "identity", 
           fill = "darkcyan") +
  geom_text(aes(label = n), 
            size= 4,
            nudge_y = 3) + ## This moves the numbers up a bit so they're easier to read. 
  scale_x_discrete(labels = function(x) lapply(strwrap(x, 
                                                       width = 10, 
                                                       simplify = FALSE), 
                                               paste, collapse="\n")) +
  theme_classic() +
  xlab("Position") +
  ylab("% Respondents") +
  ggtitle("Data Carpentry Respondents by Position/Status") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14) 
```


```{r }
# Software Carpentry Respondents by Position/Status
ordered_status <- c(    
    "Undergraduate Student",
    "Graduate Student",
    "Post-doctoral researcher",
    "Faculty",
    "Research staff (including research programmer)",
    "Support staff (including technical support)",
    "Librarian/archivist",
    "Commercial software developer",
    "Other (please specify)"
  )

swcpredata_status_tally <- 
swcpredata %>% 
  mutate(Status_ord = fct_relevel(Status, 
                                  ordered_status)) %>% 
  tally_and_perc(Status_ord, na.rm = TRUE) 
```

```{r dc-os}
## OS 
## Data Carpentry
dc_os <- dcpredata %>%
    single_answer_summary(os, unique(pull(dcpredata, os)))

dc_os_mac <- dc_os %>%
    filter(os == "Apple/Mac OS") %>%
    pull(percent)

dc_os_win <- dc_os %>%
    filter(os == "Windows") %>%
    pull(percent)

dc_os_lin <- dc_os %>%
    filter(os == "UNIX/Linux") %>%
    pull(percent)

## Table
dc_os %>%
    arrange(desc(n)) %>% 
    kable(format = 'markdown', row.names = NA,
          col.names = c ("Operating System Respondents Use in Data Carpentry Workshops", "n", "%"))
```

```{r swc_learners_status}
# Plot for Software Carpentry Respondents by Position/Status
ggplot(swcpredata_status_tally, 
       aes(Status_ord,
           y = `%`,
           n)) +
  geom_bar(stat = "identity", 
           fill = "darkcyan") +
  geom_text(aes(label = n), 
            size= 4,
            nudge_y = 3) + ## This moves the numbers up a bit so they're easier to read. 
  scale_x_discrete(labels = function(x) lapply(strwrap(x, 
                                                       width = 10, 
                                                       simplify = FALSE), 
                                               paste, collapse="\n")) +
  theme_classic() +
  xlab("Status") +
  ylab("% Respondents") +
  ggtitle("Software Carpentry Respondents by Position/Status") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14) 
```

Gender and racial/ethnic identity information is collected for U.S. participants, as we are keen to increase the number of diverse instructors and learners we serve. Understanding our demographic makeup helps us to strategize about what communities to reach and what programs to offer. 

Currently, both Data (XX%) and Software (XX%) Carpentry see strong representation from Women in the United States. Where we hope to improve is in reaching the non-White audience, as less than XX% of our respondents are from communities historically underrepresented in the science, technology, engineering, and mathematics (STEM) fields.

```{r}
# Gender Identity 
# Data Carpentry
# With what gender do you most identify?
gender = c("Female", "Male", "Transgender female", "Transgender male", "Gender variant/non-conforming", "Prefer not to answer", "Not listed (please specify")
gender = factor(gender)

dcpredata$GenderIdentity = factor(dcpredata$GenderIdentity, levels = gender)

dcpredata_gender_tally <-
  dcpredata %>%
  group_by(GenderIdentity) %>%
  tally() %>%
  filter(!is.na(GenderIdentity)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(dcpredata_gender_tally, format = 'markdown', row.names = NA, col.names = c ("Data Carpentry's U.S. Respondents' Gender Identity", "n", "%"))
```
```{r}
# Data Carpentry: Race/Ethnic Identity
# Responses are in columns 'RaceEthnicIdentity' through 'Column49'
dcpredata_race_tally <-
 dcpredata %>%
 select(RaceEthnicIdentity:Column49) %>%
 gather(col, dcpredata_race_tally) %>%
 group_by(dcpredata_race_tally) %>%
 tally_and_perc(dcpredata_race_tally, na.rm = TRUE) %>%
 filter(!is.na(dcpredata_race_tally)) %>%
 arrange(desc(n)) %>%
 rename(`RaceEthnicIdentity` = dcpredata_race_tally)

kable(dcpredata_race_tally, format = 'markdown', row.names = NA, col.names = c ("Data Carpentry's U.S. Respondents Racial/Ethnic Identity", "n", "%"))
```

```{r}
# Software Carpentry
# With what gender do you most identify?
gender = c("Female", "Male", "Other", "Prefer not to say")
gender = factor(gender)

swcpredata$Gender = factor(swcpredata$Gender, levels = gender)

swcpredata_gender_tally <-
  swcpredata %>%
  group_by(Gender) %>%
  tally() %>%
  filter(!is.na(Gender)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(dcpredata_gender_tally, format = 'markdown', row.names = NA, col.names = c ("Software Carpentry's U.S. Respondents' Gender Identity", "n", "%"))

```


```{r}
# Software Carpentry: Race/Ethnic Identity
race = c("American Indian or Alaskan Native", "Asian / Pacific Islander", "Black or African American", "Hispanic or Latino", "Native Hawaiian or Other Pacific Islander", "White / Caucasian", "Prefer not to say", "Multiple ethnicity / Other (please specify)")
race = factor(race)

swcpostdata$Race = factor(swcpostdata$Race, levels = race)

swcpostdata_race_tally <-
  swcpostdata %>%
  group_by(Race) %>%
  tally() %>%
  filter(!is.na(Race)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(swcpostdata_race_tally, format = 'markdown', row.names = NA, col.names = c ("Software Carpentry's U.S. Respondents' Racial/Ethnic Identity", "n", "%"))

# % adds up to 101, is this right?
```

### Summary







 
